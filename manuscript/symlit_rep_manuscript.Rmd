---
title             : "Young children’s spontaneous comprehension of symbol-object-relationships in the graphic domain"
shorttitle        : "Comprehension of symbol-object-relationships"

author: 
  - name          : "Gregor Kachel"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Universitätsallee 1, C1.008a, 21335 Lüneburg"
    email         : "gregor.kachel@leuphana.de"
    role: # Contributorship roles (e.g., CRediT, https://credit.niso.org/)
      - "Conceptualization"
      - "Funding Acquisition"
      - "Project Administration"
      - "Investigation"
      - "Methodology"
      - "Data Curation"
      - "Formal Analysis"
      - "Visualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Daniel Haun"
    affiliation   : "2"
    role:
      - "Resources"
      - "Writing - Review & Editing"
  - name          : "Manuel Bohn"
    affiliation   : "1"
    role:
      - "Methodology"
      - "Software"
      - "Formal Analysis"
      - "Validation"
      - "Writing - Review & Editing"
      - "Supervision"

affiliation:
  - id            : "1"
    institution   : "Leuphana University"
  - id            : "2"
    institution   : "Max-Planck-Institute for Evolutionary Anthropology"
authornote: |
    *Ethics, consent and conflict of interest*: This study confirms with recognized standards (e.g. the Declaration of Helsinki) and was approved by an internal ethics committee at the Max-Planck-Institute for Evolutionary Anthropology. Informed consent has been obtained from all participants. The authors declare no conflict of interest. 
    
    *Acknowledgments*: We are thankful to Susanne Mauritz for her help in the organization of the study and to Valerie Jurgenson and Cynthia Pones for help with data collection. We would like to thank Anne Deiglmayr for hosting this project in her research group and for her continuous support. Finally, we are very thankful to all parents and children participating in the study. Gregor Kachel was supported by the German Research Foundation (Deutsche Forschungsgemeinschaft) under project number 429220405.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  One or two sentences to put the results into a more **general context**.
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline. !Abstract must be less then 120words!
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "graphical representation, iconicity, analogy, symbol, communication, emerging literacy"
wordcount         : "Child Development Max 40 pages // PNAS 1,500–2,000 words"

bibliography      : ["library.bib"]
appendix: # to change filenames, also see end of document
  - "appendix_a_participants.Rmd"
  - "appendix_b_stimuli.Rmd"
  - "appendix_c_descriptives.Rmd"

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("library.bib")

# Loading packages 
# NOTE: this will install these packages on your machine in case they are missing

# General
if (!require(tidyverse)) install.packages('tidyverse'); library(tidyverse)
if (!require(lsr)) install.packages('lsr'); library(lsr) # Analysis, Cohen's D
if (!require(ggthemes)) install.packages('ggthemes'); library(ggthemes) # for tufte boxplots

# bayes packages
if (!require(brms)) install.packages('brms'); library(brms) # 
if (!require(tidybayes)) install.packages('tidybayes'); library(tidybayes) # 
if (!require(HDInterval)) install.packages('HDInterval'); library(HDInterval) # 

# Troubleshooting Knitting Document
# might be required for knitting manuscript
# install.packages('tinytex')
# tinytex::install_tinytex()
# 
# tinytex::tlmgr_update()
# tinytex::reinstall_tinytex()

```

```{r analysis-preferences, include = FALSE}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

# Introduction
~~Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.~~





 Preschoolers invent and comprehend iconic gestures spontaneously [@bohn2019young].

*Children's understanding of graphical representations*. 
~~Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.~~

*This Paper*. 
~~Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. For the first time, the studies contributing to this paper investigate children's understanding of xxx.~~

*Hypotheses*. ~~Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.~~

```{r rep_read_data, include = FALSE}

# Full data set including all participants (i.e. including dropped participants)
rep.data <- readRDS("../data/symlitrep_final_data.rds")

# str(rep.data)

# test <- rep.data %>%
#   filter(valid != "drop") %>%
#   group_by(study) %>%
#   summarize(min_Age = min(agem))

# test <- rep.data %>% 
#   filter(valid != "drop") %>% 
#   group_by(study, condition) %>% 
#   summarize(N = length(subid))

 # $ study          : chr w/ 3 levels --> Study1, Study2, Study3
 # $ title          : chr w/ 3 levels --> Name/Theme of the Study
 # $ condition      : chr w/ 12 levels --> Name of the condition i.e. experimental manipulation
 # $ cond           : chr w/ 12 levels --> Name of the condition in short form
 # $ subid          : chr w/ 364 levels --> Subjet ID
 # $ sex            : chr w/ 2 levels "0","1": --> Participants' sex; 1 = male
 # $ agey           : num [1:7146] total age in years
 # $ agem           : num [1:7146] total age in months 
 # $ aged           : num [1:7146] total age in days
 # $ valid          : chr w/ 3 levels --> Status of Participants
      # "valid"= main sample
      # "drop" = excluded participants
      # "oversampling" = data collected after reaching the minimum of 96 participants per study
 # $ drop           : chr w/ 7 levels "fail_in_fam",..: --> Reasons for Participant exclusions
      # fail_in_fam  --> did not meet criterion in familiarisation phase
      # fussy_child  --> child was fussy or uncooperative, lost interest in participating   
      # language     --> child did not understand instructions due to not speaking German fluently enough  
      # oversampling --> Not a drop per se: participants tested after reaching minimum of participants  
      # quit_early   --> Children that quit early and did not contribute at least 8 test trials 
      # technical    --> technical problems; i.e. script for presenting experiment crashed
 # $ trial          : chr w/ 17 levels NUmbers 1-16 for test trials; "fam" for familiarisation trials
 # $ correct        : int [1:7146] correct choice = 1; incorrect = 0
 # $ rt             : int [1:7146] reaction time in ms
 # $ experimenter   : chr w/ 6 levels --> ID of the experimenter; E1 - E6
 # $ where          : chr w/ 4 levels 
      # afterschoolcenter --> after school care; testing in the early afternoon
      # daycare --> testing in kindergartens, prior to lunch
      # home --> testing during visits at home; usually in the afternoon
      # lab --> children were tested when visiting the lab; usually in the afternoon
 # $ eselectfam     : chr w/ 2 levels "0","1" 
      # experimenter occasionally selected choices based on child's pointing during familiarisation traisl
 # $ eselectmain    : chr w/ 2 levels "0","1"
      # experimenter occasionally selected choices based on child's pointing during test trails
 # $ leftObject     : chr w/ 99 levels "abpo_tar_1_A.png" 
      # --> stimulus item displayed on the left side of the screen as target/distractor
 # $ rightObject    : chr w/ 99 levels "abpo_tar_1_A.png"
      # --> stimulus item displayed on the right side of the screen as target/distractor
 # $ cue            : chr w/ 98 levels "abpo_cue_1_A.png"
      # --> stimulus item displayed in the middle of the screen as a cue
 # $ target_position: chr w/ 2 levels "left","right": 
      # side on which the target (i.e. correct choice) was presented
 # $ item           : chr w/ 4 levels "1","2","3","4":
      # number of stimulus item in the respective condition
 # $ target_shape   : chr w/ 2 levels "A","B":
      # target stimulus shape in the respective condition
 # $ pick           : chr w/ 2 levels "
      # side of children's choice (left/right) 
 
```

```{r S1S2s3 participant demographics, echo=FALSE, eval=T}

rep.age.table.data  <- rep.data %>% 
  distinct(subid, .keep_all = TRUE) %>% # select only one line per participant
  filter(valid != "drop") %>%  # filter out dropped participants
  group_by(study) %>% 
  summarize(
    N = length(subid),
    female = sum(sex=="0"),
    Mean = mean(agem),
    Min = min(agem),
    Max = max(agem),
    SD = round(sd(agem), 2))

rep.age.table.data <- data.frame(rep.age.table.data, row.names = "study")

rep.drop.table.data  <- rep.data %>%
  distinct(subid, .keep_all = TRUE) %>% # select only one line per participant
  filter(valid == "drop") %>%
  group_by(study) %>%
  summarize(
    N = length(subid),
    female = sum(sex=="0"),
    Mean = mean(agem),
    Min = min(agem),
    Max = max(agem),
    fail_in_fam = length(subid[drop == "fail_in_fam"]),
    quit_early = length(subid[drop == "quit_early"]),
    fussy_child = length(subid[drop == "fussy_child"]),
    language = length(subid[drop == "language"]),
    technical = length(subid[drop == "technical"]))

rep.drop.table.data <- data.frame(rep.drop.table.data, row.names = "study")


```

# Methods
All three studies below share the same basic methods and analyses. For convenience, common aspects of the procedure, participant recruiting and stimulus design are reported first before discussing the indivual studies respectively.

## General Methods

### Setup and Data Collection
Children were visited in-person at their daycares. Daycares provided a separate room where experimenters (E) and children watched the presentation of a picture-book like hiding game on screen while sitting at their side. See figure \@ref(fig:figure-setup) for an illustration of the setup.

See figure XXX for an illustration of the setup.

(ref:testillustration-caption) Illustration of setup.

```{r figure-setup, fig.cap = "(ref:testillustration-caption)", fig.align = "center", echo = FALSE}
knitr::include_graphics("../illustrations/Symlit_Rep_Setup.png", dpi = 108)
```

### Procedure
*Familiarization*. 

E introduced an agent, namely a cartoon monkey, and familiarized children with the framing of the task. The monkey placed two small cups at the bottom of the screen. Next, the cups were lifted and the monkey dropped a banana under one of them. The cups were lowered again to hide the banana. Hence, children saw an item being hidden in plain sight and were solely required to remember its place for a minimal amount of time  before being asked "Where is the banana?". Children were required to point at the correct hiding place. In the familiarization phase, children received immediate feedback from the experimenter ("Well done!" / "hmm, lets go again!") while the hiding place of the banana was revealed. 

To ensure that children were familiar with the goal of the game and the touch interface, they first had to complete a set of four to eight familiarization trials with a success rate of 75%. In case a child did not reply correctly in three out of four trials, another four familiarization trials were provided. If the child was correct in six out of eight trials, she was included in the main sample. Children that did not succeed during familiarization were allowed to participate further but their data was not submitted to analysis. 

*Test phase*. The main phase of the study commenced with  announcing that the cartoon character had an idea for a new game. 


E explains that they must not see where the banana is hidden. The hiding sequence is identical to the familiarization phase, however the placement of the banana is covered by a wood fence over the lower half of the screen. Next, the monkey holds up piece of paper and a pen


 The hiding place is not revealed and children do not receive feedback in test trials. E acknowledges their choices by thanking them in a neutral tone and moves on to the next trial.

Except for the geometric shapes and their placement, the presentations in both conditions were identical. A single trial lasted 20 to 30 seconds. Children were presented with 16 test trials containing the four test conditions in a blocked order. 

In order to be submitted to the analyses participants had to complete at least eight valid test trials (see coding below).The entire test sessions lasted about 12 minutes. 

### Stimuli
Description of cues and targets and maybe how they were created. For an illustration of the stimuli and example presentations, please see supplementary materials sections XX and XX.  

### Data Handling and Analyses
Participant choices were recorded by the experimental script and directly coded as correct or incorrect. Exclusions of data were solely made on the level of the participants with regard to the exclusion  The analyses modeled participants' binary choices to predict the probability of children interpreting the cues correctly and model how this probability will change as a function of their age. 

 We used logistic Bayesian generalized linear mixed models (GLMM) to fit children's responses (0/1) as a function of their absolute age in days, condition and an interaction between trial and task. We use default priors and include trial and sex as fixed effects to be controlled for. Trial number will be added as a random slope within subject. In order to evaluate the relevance of age and condition for children’s performance, a full model was compared with a reduced model lacking the interaction of age and task using WAIC scores and weights (McElreath, 2016). Furthermore, model estimates were inspected for the different predictors (including their 95% Credible Interval (CrI)). All Bayesian models were run in Stan (http://mc-stan.org/) and implemented via the function brm of the package brms (Bürkner, 2017).

To answer our main research question of when children perform above chance in a task, we use the model to predict the developmental trajectory (with 95% CrI) for each task type. The criterion for settling when children perform above chance is the point at which the  95% CrI for a particular trajectory does no longer overlap with a midline demarcating the 50% chance level. 

To further explore our data, we also binned participants in age-groups (three-, and four-year-olds). To test whether group-level performance was above chance in all experimental groups, we used two-tailed one-sample t-tests with the chance level set to .5. We provide Cohen's d as a standardized effect size for significance testing (computed via the function `cohensD`). Additionally, each participant's data was also submitted to a binomial test to determine whether their performance was above chance on an individual level. 

## Study 1

### Participants
In order to model children's development across the preschool years continuously while aligning with conventions in the field, data collection aimed at testing two children per month of age between the third and the seventh birthday for a minimum of 96 participants (24 per year). As children were tested on the basis of availability, the final sample exceeds this preregistered minimum by ten participants. The final sample consisted of `r rep.age.table.data["study1", "N"]` children (M = `r rep.age.table.data["study1", "Mean"]` months, SD = `r rep.age.table.data["study1", "SD"]` months, range `r rep.age.table.data["study1", "Min"]` - `r rep.age.table.data["study1", "Max"]` months; `r rep.age.table.data["study1", "female"]` female). In addition, `r rep.drop.table.data["study1", "N"]` children (`r rep.drop.table.data["study1", "female"]` female) were tested but excluded from analysis for not succeeding during familiarization (N = `r rep.drop.table.data["study1", "fail_in_fam"]`), for not completing at least eight out of 16 test trials (N = `r rep.drop.table.data["study1", "quit_early"]`), or due to being fussy (N = `r rep.drop.table.data["study1", "fussy_child"]`). For `r rep.drop.table.data["study1", "language"]` children, experimenters only learned during testing that children were not fluent enough in German to participate as their families had only recently migrated. Finally, `r rep.drop.table.data["study1", "technical"]` children had to be excluded due to technical issues. For a graphical and tabular overview of participants and exclusions across all three studies presented here, please see Appendix A.

All participants were recruited in **MASKED FOR REVIEW**, a medium-sized middle-European city, and came from a predominantly white population of middle to high income families. They were contacted via a database of participants for child development studies to which their parents had voluntarily signed up. Appointments were made on the basis of parents’ and children’s availability. The study was reviewed and approved by an internal ethics committee at the **MASKED FOR REVIEW**. Data collection took place from June 2022 to February 2023. 

### Stimuli


### Analyses
The full model notation was: $'correct~condition*z.age+z.trial+z.sex+(z.trial|subid)'$
•	correct: correct choice (0/1)
•	z.age: age in days, centered to a mean of 0 
•	z.trial: trial number, scaled
•	z.sex: participants' sex (male/female), scaled


### Results

```{r rep_s1_bayes_predata, echo = FALSE, include=F, eval=T, results='asis'}

# table(rep.data$study, rep.data$condition)

# prepare data 
rep.S1.bayes.data  <- rep.data %>%
  filter(valid != "drop") %>% # valid participants only 
  filter(study == "study1") %>% # in study one
  filter(trial != "fam") %>% 
  select(condition, subid, sex, aged, correct, trial, rt) %>%
  mutate(z.trial = scale(as.numeric(trial)),
         ageinyears = aged/356.25, 
         z.age = ageinyears - mean(ageinyears),
         z.sex = scale(as.numeric(sex)))

# # clean data set? 
# str(rep.S1.bayes.data)
# sapply(rep.S1.bayes.data, function(x) sum(is.na(x)))
# 
# rep.S1.bayes.data  <- rep.data %>%
#   filter(valid != "drop") %>% # valid participants only
#   filter(study == "study1") %>% # in study one
#   filter(trial != "fam") %>%
#   select(condition, subid, sex, aged, correct, trial,rt) %>%
#   mutate(z.trial = scale(as.numeric(trial)),
#          ageinyears = aged/356.25,
#          z.age = ageinyears - mean(ageinyears),
#          z.sex = scale(as.numeric(sex)))
# 
# min(rep.S1.bayes.data$rt)
# max(rep.S1.bayes.data$rt)
# mean(rep.S1.bayes.data$rt)
# median(rep.S1.bayes.data$rt)
# hist(rep.S1.bayes.data$rt)


```

```{r rep_s1_bayes, echo = FALSE, include=F, eval=F, results='asis'}

# this is section is not evaluated to save time during knitting

# in prergistration we used the term "task" instead of "condition", same thing
# preregistered: correct ~ task*z.age +z.trial +z.sex +(z.trial|id)

S1.null.bm<-brm(correct~condition+z.age+z.trial+z.sex+(z.trial|subid), 
               data= rep.S1.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 2000,
               cores= 4)

S1.null.bm <- add_criterion(S1.null.bm, c("loo", "waic"))

S1.full.bm<-brm(correct~condition*z.age+z.trial+z.sex+(z.trial|subid), 
               data= rep.S1.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 2000,
               cores= 4)

S1.full.bm <- add_criterion(S1.full.bm, c("loo", "waic"))

S1.item.bm<-brm(correct~condition+z.age+z.trial+z.sex+(z.trial|subid)+ (z.age|item), 
               data= rep.S1.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 2000,
               cores= 4)


# Saving the model (to not rerun it every time)
saveRDS(S1.full.bm, "../models/S1.full.bm.rds")

loo_compare(S1.null.bm, S1.full.bm, criterion = "waic")%>%as_tibble(rownames = "index")

model_weights(S1.null.bm, S1.full.bm, criterion = "waic")


"significant" if elpd_diff > 2*se_diff
```

```{r rep_S1_bayes_fullmodel_prep_prepplotting, echo=FALSE, eval=T, warning = F, message=F}

# load model from rds
S1.full.bm <- readRDS("../models/S1.full.bm.rds")
# table(rep.S1.bayes.data$condition)

nd1 <- tibble(z.age = rep(seq(from = min(rep.S1.bayes.data$z.age), to = max(rep.S1.bayes.data$z.age), length.out = 50),4),
             condition = c(rep("Representation",50), 
                           rep("Pars Pro Toto",50), 
                           rep("Complex Form Analogy",50), 
                           rep("Simple Form Analogy",50)), 
             # the four conditions in the data
             z.sex = rep(0,200),
             z.trial = rep(0,200))

# here we generate the fitted values based on the model
# the function fitted() takes in the model and the new dataset and generates a fitted values (inclucing upper and lower 95% CI) for every row in the dataset
# because our dataset ranges from min age to max age in the data, we get the prediction for the age range in the data 
# but we could also generate predictions for different ages of course
f1 <- fitted(S1.full.bm, 
             newdata = nd1, 
             re_formula = NA) %>% 
  # this tells the function to ignore the random effects - in theory, we could generate predictions for specific individuals
  as_tibble() %>%
  bind_cols(nd1)%>%
  mutate(age = z.age + mean(rep.S1.bayes.data$ageinyears)) # convert age back to the original scale by adding the mean of the data


# summarize the data to include them in the plot later on
d1 <- rep.S1.bayes.data%>%
  group_by(subid, ageinyears, condition)%>%
  summarise(mean = mean(correct)) 


```

```{r S1_bayes_plot_no_facets, echo=FALSE, eval=T, warning = F, message=F}

# Plot without facetting

p1 <- f1 %>%
  mutate(age = age * 365.25)%>%
  group_by(condition)%>%
  summarise(
    Q2.5_closest_to.5 = Q2.5[which.min(abs(Q2.5-.5))],
    estimate_closest_to.5 = Estimate[which.min(abs(Q2.5-.5))],
    days = age[which.min(abs(Q2.5-.5))],
    months = round(days/30.5),
    years = round(days/365.25, 2),
    monthlabels = as.character(paste(months, "months"))
    )

ggplot()+
  geom_hline(yintercept = .5, lty = 2, alpha = .75)+
  geom_point(data = d1, aes(x = ageinyears, y = mean, col = condition), alpha = .5, shape = 1)+
  geom_smooth(data = f1, aes(x = age, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill =condition, col = condition), 
              stat = "identity", alpha = .25)+
  geom_point(data=p1, aes(x = days/365.25, y = .5, fill = condition, col = condition), stat = "identity", size=3)+
  geom_text(data=p1, aes(label = months, x = days/365.25, y = .24, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  geom_text(data=p1, aes(label = "months", x = days/365.25, y = .38, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  theme_minimal()+
  scale_color_ptol(name = "condition")+
  scale_fill_ptol(name = "condition")+
  #facet_grid(~condition)+
  labs(x = "Age", y="Proportion correct")+
  ylim(0,1)+
  xlim(3,7)+
  theme(legend.position = "bottom")



```

```{r S1_bayes_plot, echo=FALSE, eval=T, warning = F, message=F}

p1 <- f1 %>%
  mutate(age = age * 365.25)%>%
  group_by(condition)%>%
  summarise(
    Q2.5_closest_to.5 = Q2.5[which.min(abs(Q2.5-.5))],
    estimate_closest_to.5 = Estimate[which.min(abs(Q2.5-.5))],
    days = age[which.min(abs(Q2.5-.5))],
    months = round(days/30.5),
    years = round(days/365.25, 2),
    monthlabels = as.character(paste(months, "months"))
    )

S1_plot <- ggplot()+
  geom_hline(yintercept = .5, lty = 2, alpha = .75)+
  geom_point(data = d1, aes(x = ageinyears, y = mean, col = condition), alpha = .5, shape = 1)+
  geom_smooth(data = f1, aes(x = age, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill =condition, col = condition), 
              stat = "identity", alpha = .25)+
  geom_point(data=p1, aes(x = days/365.25, y = .5, fill = condition, col = condition), stat = "identity", size=3)+
  geom_text(data=p1, aes(label = months, x = days/365.25, y = .24, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  geom_text(data=p1, aes(label = "months", x = days/365.25, y = .38, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  theme_minimal()+
  scale_color_ptol(name = "condition")+
  scale_fill_ptol(name = "condition")+
  facet_grid(~condition)+
  labs(x = "Age", y="Proportion correct")+
  ylim(0,1)+
  xlim(3,7)+
  theme(legend.position = "bottom")


S1_plot

```

~~Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.~~

## Study 2


### Participants
A total of `r rep.age.table.data["study2", "N"]` three- to seven-year-old children (M = `r rep.age.table.data["study2", "Mean"]` months, SD = `r rep.age.table.data["study2", "SD"]` months, range `r rep.age.table.data["study2", "Min"]` - `r rep.age.table.data["study2", "Max"]` months; `r rep.age.table.data["study2", "female"]` female) participated. In addition, `r rep.drop.table.data["study2", "N"]` children (`r rep.drop.table.data["study2", "female"]` female) were tested but excluded from analysis for failing familiarization (N = `r rep.drop.table.data["study2", "fail_in_fam"]`), being fussy (N = `r rep.drop.table.data["study2", "fussy_child"]`), not being fluent in German (N = `r rep.drop.table.data["study2", "language"]`) or due to technical issues (N = `r rep.drop.table.data["study2", "technical"]`).

### Materials

### Data analysis

Notation 
Evaluation of model Stability 


### Results
```{r s2_bayes_prep_data, echo = FALSE, include=T, eval=T, results='asis'}

# prepare data 
rep.S2.bayes.data  <- rep.data %>%
  filter(valid != "drop") %>% # valid participants only 
  filter(study == "study2") %>% # in study one
  filter(trial != "fam") %>% 
  select(condition, subid, sex, aged, correct, trial) %>%
  mutate(z.trial = scale(as.numeric(trial)),
         ageinyears = aged/356.25, 
         z.age = ageinyears - mean(ageinyears),
         z.sex = scale(as.numeric(sex)))

 
# # prepare data 
# rep.S2.bayes.data  <- rep.data %>%
#   filter(valid != "drop") %>% # valid participants only 
#   filter(study == "study2") %>% # in study 2
#   filter(trial != "fam") %>%
#   select(condition, subid, sex, ageinyears, correct, trial) %>%
#   mutate(z.trial = scale(as.numeric(as.character(trial))),
#          z.age = agey - mean(agey),
#          z.sex = scale(as.numeric(sex)),
#          subid = paste0("id", subid))%>%
#   mutate(condition = as.character(condition))

```

```{r S2_bayes_fullmodel, echo=FALSE, include=F, eval=F}


# S2.full.bm<-brm(correct~condition+z.age+(1|subid), 
#                data=rep.S2.bayes.data, 
#                family=bernoulli(),
#                chains = 4,
#                iter= 2000,
#                cores= 4)
# 

S2.null.bm<-brm(correct~condition+z.age+z.trial+z.sex+(z.trial|subid), 
               data= rep.S2.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 2000,
               cores= 4)

S2.null.bm <- add_criterion(S2.null.bm, c("loo", "waic"))

S2.full.bm<-brm(correct~condition*z.age+z.trial+z.sex+(z.trial|subid), 
               data= rep.S2.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 2000,
               cores= 4)

S2.full.bm <- add_criterion(S2.full.bm, c("loo", "waic"))

# Saving the model (to not rerun it every time)
saveRDS(S2.full.bm, "../models/S2.full.bm.rds")

loo_compare(S2.null.bm, S2.full.bm, criterion = "waic")%>%as_tibble(rownames = "index")

model_weights(S2.null.bm, S2.full.bm, criterion = "waic")

```

```{r S2_bayes_fullmodel_prep_prepplotting, echo=FALSE, eval=T}

# load model from saving rds
S2.full.bm <- readRDS("../models/S2.full.bm.rds")

nd2 <- tibble(z.age = rep(seq(from = min(rep.S2.bayes.data$z.age), 
                              to = max(rep.S2.bayes.data$z.age), 
                              length.out = 50),4),
             condition = c(rep("Relative Position",50), 
                           rep("Absolute Position",50), 
                           rep("Orientation of Feature",50), 
                           rep("Orientation of Object",50)), # the four conditions in the data
             z.sex = rep(0,200),
             z.trial = rep(0,200))

f2 <- fitted(S2.full.bm, 
             newdata = nd2, 
             re_formula = NA) %>% 
  # this tells the function to ignore the random effects - in theory, we could generate predictions for specific individuals
  as_tibble() %>%
  bind_cols(nd2)%>%
  mutate(age = z.age + mean(rep.S2.bayes.data$ageinyears)) # convert age back to the original scale by adding the mean of the data


# summarize the data to include them in the plot later on
d2 <- rep.S2.bayes.data%>%
  group_by(subid, ageinyears, condition)%>%
  summarise(mean = mean(correct))

```

```{r S2_bayes_plot, echo=FALSE, eval=T, warning=F, message=F}

p2 <- f2 %>%
  mutate(age = age * 365.25)%>%
  group_by(condition)%>%
  summarise(
    Q2.5_closest_to.5 = Q2.5[which.min(abs(Q2.5-.5))],
    estimate_closest_to.5 = Estimate[which.min(abs(Q2.5-.5))],
    days = age[which.min(abs(Q2.5-.5))],
    months = round(days/30.5),
    years = round(days/365.25, 2),
    monthlabels = as.character(paste(months, "months"))
  )



ggplot()+
  geom_hline(yintercept = .5, lty = 2, alpha = .75)+
  geom_point(data = d2, aes(x = ageinyears, y = mean, col = condition), alpha = .5, shape = 1)+
  geom_smooth(data = f2, aes(x = age, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill =condition, col = condition), 
              stat = "identity", alpha = .25)+
  geom_point(data=p2, aes(x = days/365.25, y = .5, fill = condition, col = condition), stat = "identity", size=3)+
  geom_text(data=p2, aes(label = months, x = days/365.25, y = .24, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  geom_text(data=p2, aes(label = "months", x = days/365.25, y = .38, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  theme_minimal()+
  scale_color_ptol(name = "condition")+
  scale_fill_ptol(name = "condition")+
  #facet_grid(~condition)+
  labs(x = "Age", y="Proportion correct")+
  ylim(0,1)+
  xlim(3,7)+
  theme(legend.position = "bottom")

```

```{r S2_mixbayes_plot, echo=FALSE, eval=T, warning=F, message=F}


p2 <- f2 %>%
  mutate(age = age * 365.25)%>%
  group_by(condition)%>%
  summarise(
    Q2.5_closest_to.5 = Q2.5[which.min(abs(Q2.5-.5))],
    estimate_closest_to.5 = Estimate[which.min(abs(Q2.5-.5))],
    days = age[which.min(abs(Q2.5-.5))],
    months = round(days/30.5),
    years = round(days/365.25, 2),
    monthlabels = as.character(paste(months, "months"))
  )

ggplot()+
  geom_hline(yintercept = .5, lty = 2, alpha = .75)+
  geom_point(data = d2, aes(x = ageinyears, y = mean, col = condition), alpha = .5, shape = 1)+
  geom_smooth(data = f2, aes(x = age, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill =condition, col = condition), 
              stat = "identity", alpha = .25)+
  geom_point(data=p2, aes(x = days/365.25, y = .5, fill = condition, col = condition), stat = "identity", size=3)+
  geom_text(data=p2, aes(label = months, x = days/365.25, y = .24, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  geom_text(data=p2, aes(label = "months", x = days/365.25, y = .38, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  theme_minimal()+
  scale_color_ptol(name = "condition")+
  scale_fill_ptol(name = "condition")+
  facet_grid(~condition)+
  labs(x = "Age", y="Proportion correct")+
  ylim(0,1)+
  xlim(3,7)+
  theme(legend.position = "bottom")

```


## Study 3
General note on the aim of the investigation

### Participants
A total of `r rep.age.table.data["study3", "N"]` three- to seven-year-old children (M = `r rep.age.table.data["study3", "Mean"]` months, SD = `r rep.age.table.data["study3", "SD"]` months, range `r rep.age.table.data["study3", "Min"]` - `r rep.age.table.data["study3", "Max"]` months; `r rep.age.table.data["study3", "female"]` female) participated. In addition, `r rep.drop.table.data["study3", "N"]` children (`r rep.drop.table.data["study3", "female"]` female) were tested but excluded for low performance during familiarization (N = `r rep.drop.table.data["study3", "fail_in_fam"]`), for not completing at least eight out of 16 test trials (N = `r rep.drop.table.data["study3", "quit_early"]`), or being fussy (N = `r rep.drop.table.data["study3", "fussy_child"]`). Another `r rep.drop.table.data["study3", "language"]`children were excluded due to language problems or technical issues (N = `r rep.drop.table.data["study3", "technical"]`).

### Materials

### Analysis

Trails
Notation
Model Evaluation

### Results
```{r s3_bayes_prep_data, echo = FALSE, include=T, eval=T, results='asis'}

# prepare data 
rep.S3.bayes.data  <- rep.data %>%
  filter(valid != "drop") %>% # valid participants only 
  filter(study == "study3") %>% # in study3
  filter(trial != "fam") %>% 
  select(condition, subid, sex, aged, correct, trial, rt) %>%
  mutate(z.trial = scale(as.numeric(trial)),
         ageinyears = aged/356.25, 
         z.age = ageinyears - mean(ageinyears),
         z.sex = scale(as.numeric(sex)))

```

```{r S3_bayes_fullmodel, echo=FALSE, include=F, eval=F}

# preregistered: correct ~ task*z.age +z.trial +z.sex +(z.trial|id)

S3.full.bm<-brm(correct~condition*z.age+z.trial+z.sex+(z.trial|subid), 
                data= rep.S3.bayes.data, 
                family=bernoulli(),
                chains = 4,
                iter= 2000,
                cores= 4)

S3.full.bm <- add_criterion(S3.full.bm, c("loo", "waic"))

# Saving the model (to not rerun it every time)
saveRDS(S3.full.bm, "../models/S3.full.bm.rds")

```

```{r S3_bayes_fullmodel_prep_prepplotting, echo=FALSE, eval=T, warning=F, message=F}

# load model from saving rds
S3.full.bm <- readRDS("../models/S3.full.bm.rds")

nd3 <- tibble(z.age = rep(seq(from = min(rep.S3.bayes.data$z.age), 
                              to = max(rep.S3.bayes.data$z.age), 
                              length.out = 50),4),
             condition = c(rep("Number of Object",50), 
                           rep("Number of Feature",50), 
                           rep("Size of Object",50), 
                           rep("Size of Feature",50)),
             z.sex = rep(0,200),
             z.trial = rep(0,200))

f3 <- fitted(S3.full.bm, 
             newdata = nd3, 
             re_formula = NA) %>% 
  as_tibble() %>%
  bind_cols(nd3)%>%
  mutate(age = z.age + mean(rep.S3.bayes.data$ageinyears)) 


# summarize the data to include them in the plot later on
d3 <- rep.S3.bayes.data%>%
  group_by(subid, ageinyears, condition)%>%
  summarise(mean = mean(correct)) 

```

```{r S3_bayes_plot, echo=FALSE, eval=T, warning=F, message=F}

# Plot without facetting
p3 <- f3 %>%
  mutate(age = age * 365.25)%>%
  group_by(condition)%>%
  summarise(
    Q2.5_closest_to.5 = Q2.5[which.min(abs(Q2.5-.5))],
    estimate_closest_to.5 = Estimate[which.min(abs(Q2.5-.5))],
    days = age[which.min(abs(Q2.5-.5))],
    months = round(days/30.5),
    years = round(days/365.25, 2),
    monthlabels = as.character(paste(months, "months")))

ggplot()+
  geom_hline(yintercept = .5, lty = 2, alpha = .75)+
  geom_point(data = d3, aes(x = ageinyears, y = mean, col = condition), alpha = .5, shape = 1)+
  geom_smooth(data = f3, aes(x = age, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill =condition, col = condition), 
              stat = "identity", alpha = .25)+
  geom_point(data=p3, aes(x = days/365.25, y = .5, fill = condition, col = condition), stat = "identity", size=3)+
  geom_text(data=p3, aes(label = months, x = days/365.25, y = .24, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  geom_text(data=p3, aes(label = "months", x = days/365.25, y = .38, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  theme_minimal()+
  scale_color_ptol(name = "condition")+
  scale_fill_ptol(name = "condition")+
  #facet_grid(~condition)+
  labs(x = "Age", y="Proportion correct")+
  ylim(0,1)+
  xlim(3,7)+
  theme(legend.position = "bottom")




```

```{r S3_mixbayes_plot, echo=FALSE, eval=T, warning=F, message=F}

p3 <- f3 %>%
  mutate(age = age * 365.25)%>%
  group_by(condition)%>%
  summarise(
    Q2.5_closest_to.5 = Q2.5[which.min(abs(Q2.5-.5))],
    estimate_closest_to.5 = Estimate[which.min(abs(Q2.5-.5))],
    days = age[which.min(abs(Q2.5-.5))],
    months = round(days/30.5),
    years = round(days/365.25, 2),
    monthlabels = as.character(paste(months, "months")))

ggplot()+
  geom_hline(yintercept = .5, lty = 2, alpha = .75)+
  geom_point(data = d3, aes(x = ageinyears, y = mean, col = condition), alpha = .5, shape = 1)+
  geom_smooth(data = f3, aes(x = age, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill =condition, col = condition), 
              stat = "identity", alpha = .25)+
  geom_point(data=p3, aes(x = days/365.25, y = .5, fill = condition, col = condition), stat = "identity", size=3)+
  geom_text(data=p3, aes(label = months, x = days/365.25, y = .24, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  geom_text(data=p3, aes(label = "months", x = days/365.25, y = .38, fill = condition, col = condition), angle=90, size = 4, parse=T)+
  theme_minimal()+
  scale_color_ptol(name = "condition")+
  scale_fill_ptol(name = "condition")+
  facet_grid(~condition)+
  labs(x = "Age", y="Proportion correct")+
  ylim(0,1)+
  xlim(3,7)+
  theme(legend.position = "bottom")



```

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

# Additional Analyses

possible add-ons
- a model including all conditions
- comparing difficulty across items and tasks
- evaluating manipulations such as complex/simple; 
- reaction time analyses

Additional Analyses:

object vs feature
- orfe vs orob
- sife vs siob
- nufe vs nuob

round vs angular
- Study One Study1 - cue A = rund, cue B eckig ...if one of them is easier

Reaction Times
just reaction times and perc correct across aged


# General Discussion

Overview

Main Finding

Strengths and Implications

Limitations

# Conclusion
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

\newpage

# References

::: {#refs custom-style="Bibliography"}
:::




\newpage

# (APPENDIX) Appendix {-}

```{r child = "appendix_a_participants.Rmd"}
```

```{r child = "appendix_b_stimuli.Rmd"}
```

```{r child = "appendix_c_descriptives.Rmd"}
```

