
BACKUP VOR FINALISIERUNG

```{r S1S2S3_item_model_FINAL, echo=FALSE, eval=FALSE}

# Main analysis:
# S1.full.bm<-brm(correct~condition*z.age+z.trial+sex+(z.trial|subid) 

# STUDY 1 

# table(rep.S1.bayes.data$condition, rep.S1.bayes.data$item)
# table(rep.S1.bayes.data$item)
# table(rep.S1.bayes.data$condition)

S1.item.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|item), 
               data= rep.S1.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S1.item.model <- add_criterion(S1.item.model, c("loo", "waic"))

saveRDS(S1.item.model, "../models/S1.item.model.rds")

# Warnung: 
# 2 (0.1%) p_waic estimates greater than 0.4. We recommend trying loo instead.

# STUDY 2 

# table(rep.S2.bayes.data$condition, rep.S2.bayes.data$item)
# table(rep.S2.bayes.data$item)
# table(rep.S2.bayes.data$condition)

S2.item.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|item), 
               data= rep.S2.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S2.item.model <- add_criterion(S2.item.model, c("loo", "waic"))

# 
# Warnung: 
# 9 (0.6%) p_waic estimates greater than 0.4. We recommend trying loo instead.

saveRDS(S2.item.model, "../models/S2.item.model.rds")


# STUDY 3 

# table(rep.S2.bayes.data$condition, rep.S2.bayes.data$item)
# table(rep.S2.bayes.data$item)
# table(rep.S2.bayes.data$condition)

S3.item.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|item), 
               data= rep.S3.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S3.item.model <- add_criterion(S3.item.model, c("loo", "waic"))

# Warnung: 
# 6 (0.4%) p_waic estimates greater than 0.4. We recommend trying loo instead.

saveRDS(S3.item.model, "../models/S3.item.model.rds")

```

```{r S1_illustrationcueintercepts, echo=FALSE, eval=T}

# CUE

# summary(S1.item.model)
cue_effects <- ranef(S1.cue.model)$cue

# Extract random intercepts
cue_intercepts <- as_tibble(cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))


cue.plot <- ggplot(cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  # Remove if you want a legend
    strip.text = element_text(size = 12, face = "bold")
  )

# summary(S1.item.model)
item_effects <- ranef(S1.item.model)$item

# Extract random intercepts
item_intercepts <- as_tibble(item_effects[, , "Intercept"], rownames = "item") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(item,1,4))


item.plot <- ggplot(item_intercepts, aes(x = reorder(item, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Item-Level Random Intercepts by Condition",
    x = "Item",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold"))


# cue.plot 
# item.plot
library(patchwork)
combined_plot <- cue.plot + item.plot + plot_layout(ncol = 2)

combined_plot

```

```{r objectfeaturecomp, echo=FALSE, eval=FALSE}

objectfeature.data  <- rep.data %>%
  filter(valid != "drop") %>% # valid participants only 
  filter(trial != "fam") %>% 
  filter(cond %in% c("orfe", "orob", "sife", "siob", "nufe", "nuob")) %>% 
  select(condition, cond, subid, sex, aged, correct, trial, rt, cue) %>%
  mutate(z.trial = scale(as.numeric(trial)),
         ageinyears = aged/356.25, 
         z.age = ageinyears - mean(ageinyears),
         z.sex = scale(as.numeric(sex)),
         objectfeature = case_when(
           grepl("ob", cond) ~ "object",
           grepl("fe", cond) ~ "feature",
           TRUE ~ NA_character_))

table(objectfeature.data$condition)
table(objectfeature.data$objectfeature)

perc_objectfeature.data <- objectfeature.data %>% 
  group_by(objectfeature) %>% 
  summarize(mean = mean(correct))

perc_objectfeature.data

```

```{r roundangularcomp, echo=FALSE, eval=FALSE}


rep.S1.shape.data  <- rep.data %>%
  filter(valid != "drop") %>% # valid participants only 
  filter(study == "study1") %>% # in study one
  filter(trial != "fam") %>% 
  select(condition, subid, sex, aged, correct, trial, rt, cue) %>%
  mutate(z.trial = scale(as.numeric(trial)),
         ageinyears = aged/356.25, 
         z.age = ageinyears - mean(ageinyears),
         z.sex = scale(as.numeric(sex)),
         shape = case_when(
           grepl("A", cue) ~ "round",
           grepl("B", cue) ~ "angular",
           TRUE ~ NA_character_))

# shape    mean
# <chr>   <dbl>
#   1 angular 0.709
# 2 round   0.709

# :- D

perc_rep.S1.shape.data <- rep.S1.shape.data %>% 
  group_by(condition, shape) %>% 
  summarize(mean = mean(correct))

perc_rep.S1.shape.data

```







ALTES BACKUP


```{r S1S2S3_cue_model, echo=FALSE, eval=FALSE}

# Main analysis:
# S1.full.bm<-brm(correct~condition*z.age+z.trial+sex+(z.trial|subid) 

# STUDY 1 

# table(rep.S1.bayes.data$condition, rep.S1.bayes.data$cue)
# table(rep.S1.bayes.data$cue)
# table(rep.S1.bayes.data$condition)

S1.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
               data= rep.S1.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S1.cue.model <- add_criterion(S1.cue.model, c("loo", "waic"))

saveRDS(S1.cue.model, "../models/S1.cue.model.rds")
 
# Warnung: 
# 14 (0.8%) p_waic estimates greater than 0.4. We recommend trying loo instead.





# STUDY 2 

# table(rep.S2.bayes.data$condition, rep.S2.bayes.data$cue)
# table(rep.S2.bayes.data$cue)
# table(rep.S2.bayes.data$condition)

S2.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
               data= rep.S2.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S2.cue.model <- add_criterion(S2.cue.model, c("loo", "waic"))

saveRDS(S2.cue.model, "../models/S2.cue.model.rds")






# STUDY 3

# table(rep.S3.bayes.data$condition, rep.S3.bayes.data$cue)
# table(rep.S3.bayes.data$cue)
# table(rep.S3.bayes.data$condition)

S3.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
               data= rep.S3.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S3.cue.model <- add_criterion(S3.cue.model, c("loo", "waic"))

# Warnung: 
# 13 (0.8%) p_waic estimates greater than 0.4. We recommend trying loo instead.

saveRDS(S3.cue.model, "../models/S3.cue.model.rds")

```

```{r S1S2S3_cue_ppcheck_rhat_bulkESS, echo=FALSE, eval=FALSE}
# read in models
S1.cue.model <- readRDS("../models/S1.cue.model.rds")
S2.cue.model <- readRDS("../models/S2.cue.model.rds")
S3.cue.model <- readRDS("../models/S3.cue.model.rds")

### POSTERIOR PREDICTICE CHECKS
pp_check(S1.cue.model)
pp_check(S1.cue.model, type = "bars")

pp_check(S2.cue.model)
pp_check(S2.cue.model, type = "bars")

pp_check(S3.cue.model)
pp_check(S3.cue.model, type = "bars")


### inspect rhat --> always 1 --> good
### inspect Bulk_ESS --> always > 1000 --> good

#                       Estimate Est.Error l-95% CI 
summary(S1.cue.model) # Intercept 0.45      0.10     0.28
summary(S2.cue.model) # Intercept 0.28      0.12     0.04
summary(S3.cue.model) # Intercept 0.25      0.11     0.03


# For reporting in text:

#Study 1
S1.cue.coef <- summarise_draws(as_draws_df(S1.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# all > 1000
mean(S1.cue.coef$ess_bulk)
min(S1.cue.coef$ess_bulk)
max(S1.cue.coef$ess_bulk)
# all = 1  
mean(S1.cue.coef$rhat)
min(S1.cue.coef$rhat)
max(S1.cue.coef$rhat)



#Study 2
S2.cue.coef <- summarise_draws(as_draws_df(S2.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# all > 1000
mean(S2.cue.coef$ess_bulk)
min(S2.cue.coef$ess_bulk)
max(S2.cue.coef$ess_bulk)
# all = 1  
mean(S2.cue.coef$rhat)
min(S2.cue.coef$rhat)
max(S2.cue.coef$rhat)

#Study 3
S3.cue.coef <- summarise_draws(as_draws_df(S3.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# all > 1000
mean(S3.cue.coef$ess_bulk)
min(S3.cue.coef$ess_bulk)
max(S3.cue.coef$ess_bulk)
# all = 1  
mean(S3.cue.coef$rhat)
min(S3.cue.coef$rhat)
max(S3.cue.coef$rhat)


```

```{r S1S2S3_cue_illustrationcueintercepts, echo=FALSE, eval=FALSE}

# STUDY 1

S1.cue_effects <- ranef(S1.cue.model)$cue

# Extract random intercepts
S1.cue_intercepts <- as_tibble(S1.cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))

S1.cue.plot <- ggplot(S1.cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  
    strip.text = element_text(size = 12, face = "bold"))




# STUDY 2

S2.cue_effects <- ranef(S2.cue.model)$cue

# Extract random intercepts
S2.cue_intercepts <- as_tibble(S2.cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))

S2.cue.plot <- ggplot(S2.cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  
    strip.text = element_text(size = 12, face = "bold"))


# STUDY 2

S3.cue_effects <- ranef(S3.cue.model)$cue

# Extract random intercepts
S3.cue_intercepts <- as_tibble(S3.cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))

S3.cue.plot <- ggplot(S3.cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  
    strip.text = element_text(size = 12, face = "bold"))


```

```{r S1S2S3_cue_ppcheck, echo=FALSE, eval=FALSE}
# read in models
S1.cue.model <- readRDS("../models/S1.cue.model.rds")
S1.item.model <- readRDS("../models/S1.item.model.rds")

### POSTERIOR PREDICTICE CHECKS
# cue
pp_check(S1.cue.model)
pp_check(S1.cue.model, type = "bars")
# item
pp_check(S1.item.model)
pp_check(S1.item.model, type = "bars")

summary(S1.cue.model) # Intercept 0.45 .10-.27
summary(S1.item.model) # Intercept  0.17 .01-.40

```

```{r S1S2S3_cue_rhat_bulkESS, echo=FALSE, eval=FALSE}

### EFFECTICE SAMPLE SIZES
### inspect rhat --> always 1 --> good
### inspect Bulk_ESS --> always > 1000 --> good
# summary(S1.item.model)

S1.cue.coef <- summarise_draws(as_draws_df(S1.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

S1.item.coef <- summarise_draws(as_draws_df(S1.item.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# CUE
# all > 1000
mean(S1.cue.coef$ess_bulk)
min(S1.cue.coef$ess_bulk)
max(S1.cue.coef$ess_bulk)
# all = 1  
mean(S1.cue.coef$rhat)
min(S1.cue.coef$rhat)
max(S1.cue.coef$rhat)

# ITEM
# all > 1000
mean(S1.item.coef$ess_bulk)
min(S1.item.coef$ess_bulk)
max(S1.item.coef$ess_bulk)

# all = 1  
mean(S1.item.coef$rhat)
min(S1.item.coef$rhat)
max(S1.item.coef$rhat)


# Cue Intercept beta = `r S1.full.coef["sd_cue__Intercept", "mean"]`,
# 95% CrI [`r S1.full.coef["sd_cue__Intercept", "q5"]`, `r S1.full.coef["sd_cue__Intercept", "q95"]`]

# Cue Type	Log-Odds	Accuracy (%)
# Average cue	        2.10	89.1%
# 1 SD below average	1.65	84.0%
# 1 SD above average	2.55	92.7%


```


```{r S1S2S3_cue_model, echo=FALSE, eval=FALSE}

# Main analysis:
# S1.full.bm<-brm(correct~condition*z.age+z.trial+sex+(z.trial|subid) 

# STUDY 1 

# table(rep.S1.bayes.data$condition, rep.S1.bayes.data$cue)
# table(rep.S1.bayes.data$cue)
# table(rep.S1.bayes.data$condition)

S1.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
               data= rep.S1.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S1.cue.model <- add_criterion(S1.cue.model, c("loo", "waic"))

saveRDS(S1.cue.model, "../models/S1.cue.model.rds")
 
# Warnung: 
# 14 (0.8%) p_waic estimates greater than 0.4. We recommend trying loo instead.





# STUDY 2 

# table(rep.S2.bayes.data$condition, rep.S2.bayes.data$cue)
# table(rep.S2.bayes.data$cue)
# table(rep.S2.bayes.data$condition)

S2.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
               data= rep.S2.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S2.cue.model <- add_criterion(S2.cue.model, c("loo", "waic"))

saveRDS(S2.cue.model, "../models/S2.cue.model.rds")






# STUDY 3

# table(rep.S3.bayes.data$condition, rep.S3.bayes.data$cue)
# table(rep.S3.bayes.data$cue)
# table(rep.S3.bayes.data$condition)

S3.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
               data= rep.S3.bayes.data, 
               family=bernoulli(),
               chains = 4,
               iter= 5000,
               cores= 4)

S3.cue.model <- add_criterion(S3.cue.model, c("loo", "waic"))

# Warnung: 
# 13 (0.8%) p_waic estimates greater than 0.4. We recommend trying loo instead.

saveRDS(S3.cue.model, "../models/S3.cue.model.rds")

```

```{r S1S2S3_cue_ppcheck_rhat_bulkESS, echo=FALSE, eval=FALSE}
# read in models
S1.cue.model <- readRDS("../models/S1.cue.model.rds")
S2.cue.model <- readRDS("../models/S2.cue.model.rds")
S3.cue.model <- readRDS("../models/S3.cue.model.rds")

### POSTERIOR PREDICTICE CHECKS
pp_check(S1.cue.model)
pp_check(S1.cue.model, type = "bars")

pp_check(S2.cue.model)
pp_check(S2.cue.model, type = "bars")

pp_check(S3.cue.model)
pp_check(S3.cue.model, type = "bars")


### inspect rhat --> always 1 --> good
### inspect Bulk_ESS --> always > 1000 --> good

#                       Estimate Est.Error l-95% CI 
summary(S1.cue.model) # Intercept 0.45      0.10     0.28
summary(S2.cue.model) # Intercept 0.28      0.12     0.04
summary(S3.cue.model) # Intercept 0.25      0.11     0.03


# For reporting in text:

#Study 1
S1.cue.coef <- summarise_draws(as_draws_df(S1.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# all > 1000
mean(S1.cue.coef$ess_bulk)
min(S1.cue.coef$ess_bulk)
max(S1.cue.coef$ess_bulk)
# all = 1  
mean(S1.cue.coef$rhat)
min(S1.cue.coef$rhat)
max(S1.cue.coef$rhat)



#Study 2
S2.cue.coef <- summarise_draws(as_draws_df(S2.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# all > 1000
mean(S2.cue.coef$ess_bulk)
min(S2.cue.coef$ess_bulk)
max(S2.cue.coef$ess_bulk)
# all = 1  
mean(S2.cue.coef$rhat)
min(S2.cue.coef$rhat)
max(S2.cue.coef$rhat)

#Study 3
S3.cue.coef <- summarise_draws(as_draws_df(S3.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# all > 1000
mean(S3.cue.coef$ess_bulk)
min(S3.cue.coef$ess_bulk)
max(S3.cue.coef$ess_bulk)
# all = 1  
mean(S3.cue.coef$rhat)
min(S3.cue.coef$rhat)
max(S3.cue.coef$rhat)


```

```{r S1S2S3_cue_illustrationcueintercepts, echo=FALSE, eval=FALSE}

# STUDY 1

S1.cue_effects <- ranef(S1.cue.model)$cue

# Extract random intercepts
S1.cue_intercepts <- as_tibble(S1.cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))

S1.cue.plot <- ggplot(S1.cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  
    strip.text = element_text(size = 12, face = "bold"))




# STUDY 2

S2.cue_effects <- ranef(S2.cue.model)$cue

# Extract random intercepts
S2.cue_intercepts <- as_tibble(S2.cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))

S2.cue.plot <- ggplot(S2.cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  
    strip.text = element_text(size = 12, face = "bold"))


# STUDY 2

S3.cue_effects <- ranef(S3.cue.model)$cue

# Extract random intercepts
S3.cue_intercepts <- as_tibble(S3.cue_effects[, , "Intercept"], rownames = "cue") %>%
  rename(
    estimate = Estimate,
    lower = Q2.5,
    upper = Q97.5) %>% 
  mutate(condition = substr(cue,1,4))

S3.cue.plot <- ggplot(S3.cue_intercepts, aes(x = reorder(cue, estimate), y = estimate, color = condition)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  coord_flip() +
  facet_wrap(~ condition, scales = "free_y", ncol = 1) +
  labs(
    title = "Cue-Level Random Intercepts by Condition",
    x = "Cue",
    y = "Estimated Deviation from Overall Intercept (log-odds)",
    color = "Condition"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",  
    strip.text = element_text(size = 12, face = "bold"))


```

```{r S1S2S3_cue_ppcheck, echo=FALSE, eval=FALSE}
# read in models
S1.cue.model <- readRDS("../models/S1.cue.model.rds")
S1.item.model <- readRDS("../models/S1.item.model.rds")

### POSTERIOR PREDICTICE CHECKS
# cue
pp_check(S1.cue.model)
pp_check(S1.cue.model, type = "bars")
# item
pp_check(S1.item.model)
pp_check(S1.item.model, type = "bars")

summary(S1.cue.model) # Intercept 0.45 .10-.27
summary(S1.item.model) # Intercept  0.17 .01-.40

```

```{r S1S2S3_cue_rhat_bulkESS, echo=FALSE, eval=FALSE}

### EFFECTICE SAMPLE SIZES
### inspect rhat --> always 1 --> good
### inspect Bulk_ESS --> always > 1000 --> good
# summary(S1.item.model)

S1.cue.coef <- summarise_draws(as_draws_df(S1.cue.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

S1.item.coef <- summarise_draws(as_draws_df(S1.item.model)) %>%
  filter(grepl("^b_", variable) |
         grepl("^sd_", variable)) %>%
  mutate(variable = gsub("b_", "", variable)) %>%
  mutate(variable = gsub("condition", "", variable)) %>%
  data.frame(row.names = "variable")

# CUE
# all > 1000
mean(S1.cue.coef$ess_bulk)
min(S1.cue.coef$ess_bulk)
max(S1.cue.coef$ess_bulk)
# all = 1  
mean(S1.cue.coef$rhat)
min(S1.cue.coef$rhat)
max(S1.cue.coef$rhat)

# ITEM
# all > 1000
mean(S1.item.coef$ess_bulk)
min(S1.item.coef$ess_bulk)
max(S1.item.coef$ess_bulk)

# all = 1  
mean(S1.item.coef$rhat)
min(S1.item.coef$rhat)
max(S1.item.coef$rhat)


# Cue Intercept beta = `r S1.full.coef["sd_cue__Intercept", "mean"]`,
# 95% CrI [`r S1.full.coef["sd_cue__Intercept", "q5"]`, `r S1.full.coef["sd_cue__Intercept", "q95"]`]

# Cue Type	Log-Odds	Accuracy (%)
# Average cue	        2.10	89.1%
# 1 SD below average	1.65	84.0%
# 1 SD above average	2.55	92.7%


```


# reste aus appendix E - additional analyses


oh no, cue model is better than item model

```{r S1_itemvscue, echo=F, eval= T}

### MODEL COMPARISON
S1.itemvscue.comp <- loo_compare(S1.item.model, S1.cue.model, criterion = "waic")%>%as_tibble(rownames = "index")
S1.itemvscue.comp  <- data.frame(S1.itemvscue.comp , row.names = "index")

S1.itemvscue.comp




```

now check cue vs full model
```{r S1_cuevsfull_comp, echo=F, eval= T}

### MODEL COMPARISON
S1.cuevsfull.comp <- loo_compare(S1.cue.model, S1.full.bm, criterion = "waic")%>%as_tibble(rownames = "index")
S1.cuevsfull.comp  <- data.frame(S1.cuevsfull.comp , row.names = "index")

S1.cuevsfull.comp

```


## Study 1 CUE
Additional Tables and illustrations for the convenience of the reader. Add illustrations they said; it will add value they said.

Cues do differ in baseline difficulty and their interaction with age, with easier items tending to show stronger positive age effects.

The strong positive correlation (cor(Intercept,z.age) 0.79) shows that age effects are stronger for easier items, while difficult items are relatively unaffected by age.

--> That is, there are some items that are more difficult and for the difficult items there is less increase over the age-window ...this is, what we wanted.

Plotting the cue-level random intercepts reveals, that within a given condition, items are largely similar. This is especially true for pars and rep.

```{r S1_cue_summaryxy, echo=FALSE, eval=T}

summary(S1.cue.model)

# print(S1.cue.model, digits = 2)   
# posterior_summary(S1.cue.model)   
# fixef(S1.cue.model)               
# ranef(S1.cue.model)       

```



```{r S1_cue_plotxy, echo=FALSE, eval=T}

S1.cue.plot

```

# RESTE
Additional Tables and illustrations for the convenience of the reader. Add illustrations they said; it will add value they said.
```{r S1_cue_modelold, echo=FALSE, eval=FALSE}

# S1.full.bm<-brm(correct~condition*z.age+z.trial+sex+(z.trial|subid), 
# table(rep.S1.bayes.data$condition, rep.S1.bayes.data$cue)



S1.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
                  data= rep.S1.bayes.data, 
                  family=bernoulli(),
                  chains = 4,
                  iter= 2000,
                  cores= 4)

S1.cue.model <- add_criterion(S1.cue.model, c("loo", "waic"))


saveRDS(S1.cue.model, "../models/S1.cue.model.rds")

```

```{r S2_cue_modelold, echo=FALSE, eval=FALSE}


# S1.full.bm<-brm(correct~condition*z.age+z.trial+sex+(z.trial|subid), 
# table(rep.S2.bayes.data$condition, rep.S2.bayes.data$cue)

S2.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
                  data= rep.S2.bayes.data, 
                  family=bernoulli(),
                  chains = 4,
                  iter= 5000,
                  cores= 4)

S2.cue.model <- add_criterion(S2.cue.model, c("loo", "waic"))


saveRDS(S2.cue.model, "../models/S2.cue.model.rds")

```





```{r S2_cueplotxy, echo=FALSE, eval=T}

summary(S2.cue.model)

# print(S2.cue.model, digits = 2)   
# posterior_summary(S2.cue.model)   
# fixef(S2.cue.model)               
# ranef(S2.cue.model)               


```


```{r S2_cueplotxyz, echo=FALSE, eval=T}

S2.cue.plot

```



Additional Tables and illustrations for the convenience of the reader. Add illustrations they said; it will add value they said.

```{r S3_cueplotxy, echo=FALSE, eval=T}

summary(S3.cue.model)


# print(S3.cue.model, digits = 2)   
# posterior_summary(S3.cue.model)   
# fixef(S3.cue.model)               
# ranef(S3.cue.model)               
```


```{r S3_cueplotxyz, echo=FALSE, eval=T}

S3.cue.plot

```







```{r S3_cue_modelold, echo=FALSE, eval=FALSE}


# S1.full.bm<-brm(correct~condition*z.age+z.trial+sex+(z.trial|subid), 
# table(rep.S2.bayes.data$condition, rep.S2.bayes.data$cue)

S3.cue.model<-brm(correct ~ condition*z.age +z.trial +sex +(z.trial|subid) +(z.age|cue), 
                  data= rep.S3.bayes.data, 
                  family=bernoulli(),
                  chains = 4,
                  iter= 5000,
                  cores= 4)

S3.cue.model <- add_criterion(S3.cue.model, c("loo", "waic"))


saveRDS(S3.cue.model, "../models/S3.cue.model.rds")

```


